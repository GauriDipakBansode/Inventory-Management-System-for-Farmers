<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Manage Crops</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      padding: 30px;
    }
    .form-section {
      margin-bottom: 50px;
    }
    .card {
      margin-bottom: 20px;
      border: 1px solid #198754;
    }
    h2, h4 {
      color: #000000;
      margin-bottom: 25px;
      font-weight: normal;
    }
    label {
      color: #000000;
      font-weight: normal;
    }
    .btn-space {
      margin-right: 15px;
    }
  </style>
</head>
<body>

<div class="container">
  <h2>Manage Crops</h2>

  <!-- Add New Crop Section -->
  <div class="form-section">
    <h4>Add New Crop</h4>
    <div class="row g-4">
      <div class="col-md-4">
        <label>Crop Name</label>
        <input type="text" id="crop_name" class="form-control" placeholder="Enter Crop Name">
      </div>
      <div class="col-md-4">
        <label>Crop Type</label>
        <select id="crop_type" class="form-select">
          <option selected disabled>-- Select Type --</option>
          <option>Fruit</option>
          <option>Vegetable</option>
          <option>Cereal</option>
          <option>Pulse</option>
          <option>Oilseed</option>
        </select>
      </div>
      <div class="col-md-4">
        <label>Season</label>
        <select id="season" class="form-select">
          <option selected disabled>-- Select Season --</option>
          <option>Kharif</option>
          <option>Rabi</option>
          <option>Zaid</option>
        </select>
      </div>

      <div class="col-md-4">
        <label>Planting Date</label>
        <input type="date" id="planting_date" class="form-control">
      </div>
      <div class="col-md-4">
        <label>Harvesting Date</label>
        <input type="date" id="harvesting_date" class="form-control">
      </div>
      <div class="col-md-4">
        <label>Growth Stage</label>
        <select id="growth_stage" class="form-select">
          <option selected disabled>-- Select Growth Stage --</option>
          <option>Seedling</option>
          <option>Sowing</option>
          <option>Germination</option>
          <option>Vegetative</option>
          <option>Flowering</option>
          <option>Fruiting</option>
          <option>Maturity</option>
        </select>
      </div>

      <div class="col-12 mt-4">
        <button class="btn btn-success btn-space" onclick="addCrop()">‚ûï Add Crop</button>
        <a href="/dashboard" class="btn btn-outline-success">‚¨ÖÔ∏è Go to Dashboard</a>
      </div>
    </div>
  </div>

  <hr class="text-success">

  <!-- Update Growth Stage Section -->
  <div class="form-section">
    <h4>Update Growth Stage</h4>
    <div class="row g-4">
      <div class="col-md-6">
        <label>Select Crop</label>
        <select id="crop_select" class="form-select">
          <option selected disabled>-- Select Crop --</option>
        </select>
      </div>
      <div class="col-md-6">
        <label>New Growth Stage</label>
        <select id="new_growth_stage" class="form-select">
          <option selected disabled>-- Select New Growth Stage --</option>
          <option>Seedling</option>
          <option>Vegetative</option>
          <option>Flowering</option>
          <option>Fruiting</option>
          <option>Harvesting</option>
          <option>Germination</option>
        </select>
      </div>

      <div class="col-12 mt-4">
        <button class="btn btn-success" onclick="updateGrowthStage()">üîÑ Update Growth Stage</button>
      </div>
    </div>
  </div>

  <hr class="text-success">

  <!-- Current Crops Section -->
  <div class="form-section">
    <h4>Current Crops</h4>
    <div id="crops_list"></div>
  </div>
</div>

<script>
async function addCrop() {
  const crop = {
    name: document.getElementById('crop_name').value,
    type: document.getElementById('crop_type').value,
    season: document.getElementById('season').value,
    planting_date: document.getElementById('planting_date').value,
    harvesting_date: document.getElementById('harvesting_date').value,
    growth_stage: document.getElementById('growth_stage').value
  };

  const response = await fetch('/add-crop', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(crop)
  });

  const result = await response.json();
  alert(result.message || result.error);
  loadCrops();
}

async function loadCrops() {
  const response = await fetch('/get-crops');
  const crops = await response.json();

  const cropsList = document.getElementById('crops_list');
  const cropSelect = document.getElementById('crop_select');
  cropsList.innerHTML = '';
  cropSelect.innerHTML = '<option selected disabled>-- Select Crop --</option>';

  crops.forEach(crop => {
    const card = document.createElement('div');
    card.className = 'card p-3';

    card.innerHTML = `
      <b>${crop.name}</b> (${crop.growth_stage})<br>
      Type: ${crop.type} | Season: ${crop.season}<br>
      Planting: ${crop.planting_date || 'N/A'} | Harvesting: ${crop.harvesting_date || 'N/A'}
      <div class="mt-2">
        <button class="btn btn-danger btn-sm" onclick="deleteCrop(${crop.id})">üóëÔ∏è Delete</button>
      </div>
    `;
    cropsList.appendChild(card);

    const option = document.createElement('option');
    option.value = crop.id;
    option.text = crop.name;
    cropSelect.appendChild(option);
  });
}

async function deleteCrop(id) {
  const response = await fetch(`/delete-crop/${id}`, { method: 'DELETE' });
  const result = await response.json();
  alert(result.message || result.error);
  loadCrops();
}

async function updateGrowthStage() {
  const cropId = document.getElementById('crop_select').value;
  const newStage = document.getElementById('new_growth_stage').value;

  const response = await fetch(`/update-growth-stage/${cropId}`, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ growth_stage: newStage })
  });

  const result = await response.json();
  alert(result.message || result.error);
  loadCrops(); // Reload the crops to show updated growth stages
}


window.onload = loadCrops;
</script>

</body>
</html>
